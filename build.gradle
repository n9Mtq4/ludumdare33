group 'ludumdare33'

apply plugin: 'java'

sourceCompatibility = 1.6

repositories {
    mavenCentral()
}

//com.n9mtq4.ld33.yatm.launcher.Launcher
//com.n9mtq4.ld33.yatm.game.YouAreTheMonster
jar {
    manifest {
        attributes 'Main-Class': 'com.n9mtq4.ld33.yatm.launcher.Launcher'
//        attributes 'Main-Class': 'com.n9mtq4.ld33.yatm.game.YouAreTheMonster'
    }
}

gradle.taskGraph.afterTask { Task task, TaskState state ->
//    if the build succeeded
    if (!state.failure && task.name.equalsIgnoreCase('build')) {
//        copy the jar into the distro directory
        copy {
            from('build/libs/' + project.getName() + '.jar')
            into('.')
        }
        exec {
//            zip the sources into a file too.
            executable 'bash'
            //noinspection GroovyAssignabilityCheck
            args '-c', 'rm ' + project.getName() + '-source.zip; cd src/main/; find . -name \'*.DS_Store\' -type f -delete; zip ../../' + project.getName() + '-source.zip -r java -x .* -Z deflate'
        }
    }
}
